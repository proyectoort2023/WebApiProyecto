@page "/ORGANIZADOR/Principal"
@inject ServicioMenu _servicioMenu
@inject TorneoServicio _servicio_Torneo
@inject UsuarioServicio _servicioUsuario
@inject NavigationManager _nav



@if (Torneos != null && Torneos.Count > 0)
{
    @foreach (var torneo in Torneos)
    {
        <ItemTorneo Bannertorneo = "@torneo.Banner"
                    LogoTorneo = "@torneo.Logo"
                    NombreTorneo="@torneo.Nombre"
                    TorneoId="@torneo.Id"
                    VtoInscripcion="@torneo.Fecha.AddDays(-1).ToString("dd/MM/yyyy")" />
    }
}
else
{
    <h2>Todavia no tiene torneos creados</h2>
}

<MudFab Style="@_servicioMenu.ClassFabColor()" StartIcon="@Icons.Material.Filled.Add" Size="Size.Medium" OnClick="NuevoTorneo"/>


<EspacioVertical Altura="10vh" />

@code {

    List<MenuItem> menusItems = new();
    List<TorneoDTO> Torneos = new();

    protected async override Task OnInitializedAsync()
    {
        ActualizarMenu();
        ActualizarTorneos();
    }
    protected async override Task OnAfterRenderAsync(bool firstRender)
    {
        ActualizarMenu();
    }

    private void ActualizarMenu()
    {
        menusItems = new List<MenuItem>()
        {
            new MenuItem ("Mensajes","fa fa-envelope","/counter"),
            new MenuItem ("Mis torneos","fa fa-trophy","/fetchdata"),
            new MenuItem ("Deudores","fa fa-money-bill","/login")
        };
        _servicioMenu.ActualizarItems(menusItems);
        _servicioMenu.ActualizarTitulo("Mis torneos");
        _servicioMenu.ActualizarNavegacionPOP(true, true, "/");
    }

    private async void ActualizarTorneos()
    {
        try
        {
            int idOrganizador = _servicioUsuario.ObtenerUsuarioLogueado().Id;
            Torneos = await _servicio_Torneo.ObtenerTorneosOrganizador(idOrganizador);
            StateHasChanged();
        }
        catch (Exception)
        {
            _nav.NavigateTo("/", true);
        }

    }

    private void NuevoTorneo()
    {
        _nav.NavigateTo("/ORGANIZADOR/CreacionTorneo");
    }



   
}
